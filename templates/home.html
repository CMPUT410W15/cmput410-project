<!--### Source material taken from:
###     https://mayukhsaha.wordpress.com/2013/05/09/simple-login-and-user-registration-application-using-django/
###     March 2, 2015
### No explicit license -->

<!-- Still a work in progress , https://realpython.com/blog/python/django-and-ajax-form-submissions/
,https://github.com/realpython/django-form-fun -->
{% extends "base.html" %}
{% load staticfiles %}
{% block title %}Home Page{% endblock %}
{% block content %}

<div class="row">
    <div class="col-md-3">
        <div class= "panel panel-default">
            <div class= "panel-heading" style="text-align: center;">
                <h4 class="panel-title"> {{user.username}} </h4>
            </div>
            <div class= "panel-body" style="text-align: center;">
                <img src="{% static 'profile.png' %}" alt="profile picture" style="height:160px; width:160px;" class= "center-block"/>
                </br>
                </br>
                {% if user.email %}
                    <h4> Email: {{ user.email }}</h4>
                {% endif %}
            </div>
        </div>
    </div>
    <div class= "col-md-7 col-md-push-2" >
        {% if posts %}
            {% for p in posts %}
                <div class= "panel panel-default">
                    <div class= "panel-heading">
                        <span class="pull-left"> <img src= "{% static 'profile.png' %}" alt="profile picture" 
                            style= "height:40px; width:40px;"/> </span>
                        <span style="display:inline-block; padding-left: 5pt;"> 
                            {{p.send_author}} 
                            {% if p.receive_author %}
                                <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"> </span> {{p.receive_author}}
                            {% endif %}
                            </br> 
                            {{p.published}} 
                            </br> 
                            {{p.title}} 
                        </span>
                        {% if author == p.send_author %}
                            <span class="pull-right">
                                <form id="{{p.uid}}" method="POST" action="/post/delete/{{p.uid}}">
                                {% csrf_token %}
                                    <a href="javascript:document.forms['{{p.uid}}'].submit();">
                                        <img src= "{% static 'icons/0173-bin.svg' %}"
                                        alt="delete icon" style= "height:30px; width:30px;"/>
                                    </a>
                                </form>
                            </span>
                        {% endif %}
                    </div>
                    <div class= "panel-body">
                        {{p.markdown_to_html}}
                            <h5 style= "text-decoration: underline;"> Comments </h5>
                            <ul id='{{p.uid}}-2'>
                        {% if p.get_comments %}
                            {% for comments in p.get_comments %}
                                <li id='{{comments.uid}}'> {{comments}} </li>
                            {% endfor %}
                        {% endif %}
                        </ul>
                    </div>
                    <div class= "panel-footer clearfix">
                        <form id= "{{p.uid}}-1" class= "form-horizontal" method= 'post'>
                            {% csrf_token %}
                        <div id= "error{{p.uid}}"> 
                        </div>
                    <div class= "col-sm-10">
                        <input class="form-control" id="content{{p.uid}}" name="content" type="text">
                    </div>
                    <span class="pull-right">
                        <input class="btn btn-primary" type="submit" value="Comment" />
                    </span>
                        </form>
                    </div>
                <script>

                //Setup javascript variables created to reference template variables for stream.js to use.

                var comment_button_id='#{{p.uid}}-1';
                //var post_id= "#{{p.uid}}";
                var comment_list_id= "#{{p.uid}}-2";
                var single_comment_id= "{{comments.uid}}";

                var error_message_id="#error{{p.uid}}";
                var content_id= "#content{{p.uid}}";
                var comment_url= "/post/comment/{{p.uid}}/";
                </script>
                
                <script src= "{% static "scripts/stream.js" %}"> </script>
            </div>
            {% endfor %}
        {% else %}
        {% endif %}
    </div>
</div>

{% endblock %}
